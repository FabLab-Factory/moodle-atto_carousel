YUI.add("moodle-atto_carousel-button",function(u,e){var d={ADDIMAGE:"atto_carousel_addmore",ELEMENT:"carousel-element",RESPONSIVE:"img-responsive",INPUTALIGNMENT:"atto_carousel_alignment",INPUTALT:"atto_carousel_altentry",INPUTHEIGHT:"atto_carousel_heightentry",INPUTSUBMIT:"atto_carousel_urlentrysubmit",INPUTADDIMAGE:"atto_carousel_addimage",INPUTURL:"atto_carousel_urlentry",INPUTSIZE:"atto_carousel_size",INPUTWIDTH:"atto_carousel_widthentry",IMAGEALTWARNING:"atto_carousel_altwarning",IMAGEBROWSER:"atto_carousel_openimagebrowser",IMAGEPRESENTATION:"atto_carousel_presentation",INPUTCONSTRAIN:"atto_carousel_constrain",INPUTCUSTOMSTYLE:"atto_carousel_customstyle",IMAGEPREVIEW:"atto_carousel_preview",IMAGEPREVIEWBOX:"atto_carousel_preview_box",ALIGNSETTINGS:"atto_carousel_button",CAROUSELID:"atto_carousel_id"},t={INPUTURL:"."+d.INPUTURL},o=[{name:"verticalAlign",str:"alignment_top",value:"text-top",margin:"0 0.5em"}],a="atto_carousel";u.namespace("M.atto_carousel").Button=u.Base.create("button",u.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_selectedImage:null,_attoform:null,_numberOfImages:1,_rawImageDimensions:null,initializer:function(){this.addButton({icon:M.util.image_url("ed/editor_icon1","atto_carousel"),callback:this._displayDialogue,tags:".carousel",tagMatchRequiresAll:!1}),this.editor.delegate("dblclick",this._displayDialogue,".carousel",this),this.editor.on("drop",this._handleDragDrop,this),this.editor.on("dragover",function(e){e.preventDefault()},this),this.editor.on("dragenter",function(e){e.preventDefault()},this)},_handleClick:function(e){var t=e.target,s=this.get("host").getSelectionFromNode(t);this.get("host").getSelection()!==s&&this.get("host").setSelection(s)},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(this._rawImageDimensions=null,this.getDialogue({headerContent:M.util.get_string("imageproperties",a),width:"auto",focusAfterHide:!0,focusOnShowSelector:t.INPUTURL}).set("bodyContent",this._getDialogueContent()).show())},_loadPreviewImage:function(e){var t=new Image,s=this;t.onerror=function(){s._attoform.one("."+d.IMAGEPREVIEW+"-"+indexImage).setStyles({display:"none"}),s.getDialogue().centerDialogue()},t.onload=function(){var e;s._rawImageDimensions={width:this.width,height:this.height},(e=s._attoform.one("."+d.IMAGEPREVIEW+"-"+indexImage)).setAttribute("src",this.src),e.setStyles({display:"inline"}),s.getDialogue().centerDialogue()},t.src=e},_getDialogueContent:function(){var e,t=u.Handlebars.compile('<form class="atto_attoform"><div class="container"><div class="row"><div class="col-12 mb-1"><label for="{{CSS.CAROUSELID}}">{{get_string "entercarouselid" component}}</label><input class="form-control fullwidth {{CSS.CAROUSELID}} " type="text" id="{{CSS.CAROUSELID}}" size="32"/></div></div><div class="row"><div class="col-md-6">{{#if showFilepicker}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><div class="input-group input-append w-100"><input class="form-control {{CSS.INPUTURL}} {{CSS.INPUTURL}}-1" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/><span class="input-group-append"><button class="btn btn-secondary {{CSS.IMAGEBROWSER}} {{CSS.IMAGEBROWSER}}-1" type="button">{{get_string "browserepositories" component}}</button></span></div></div>{{else}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><input class="form-control fullwidth {{CSS.INPUTURL}} {{CSS.INPUTURL}}-1" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div>{{/if}}</div><div class="col-md-6"><div class="mdl-align"><div class="{{CSS.IMAGEPREVIEWBOX}}"><img src="#" class="{{CSS.IMAGEPREVIEW}} {{CSS.IMAGEPREVIEW}}-1" alt="" style="display: none;"/></div></div></div></div><div class="row {{CSS.ADDIMAGE}}"><div class="col-12"><button class="btn btn-secondary {{CSS.INPUTADDIMAGE}}" type="button">{{get_string "addimage" component}}</button></div></div><div class="row"><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "saveimage" component}}</button></div></div></form>'),s=this.get("host").canShowFilepicker("image"),i=u.Node.create(t({elementid:this.get("host").get("elementid"),CSS:d,component:a,showFilepicker:s}));return this._attoform=i,this._applyImageProperties(this._attoform,1),this._attoform.one("."+d.INPUTURL+"-1").on("blur",this._getUrlChanged(this._attoform,1),this),this._attoform.one("."+d.INPUTSUBMIT).on("click",this._setCarousel,this),s&&i.delegate("click",function(e){var t=this._attoform;e.preventDefault(),this.get("host").showFilepicker("image",this._getFilepickerCallback(t,1),this)},".atto_carousel_openimagebrowser-1",this),e=this.get("host").get("elementid"),this._attoform.one("."+d.INPUTADDIMAGE).on("click",this._getAddNewImage(this._attoform,e,d,a,s,o,this),this),i},_getFilepickerCallback:function(s,i){return function(e){var t;""!==e.url&&(s.one("."+d.INPUTURL+"-"+i).set("value",e.url),(t=new Image).onerror=function(){s.one("."+d.IMAGEPREVIEW+"-"+i).setStyles({display:"none"})},t.onload=function(){var e;(e=s.one("."+d.IMAGEPREVIEW+"-"+i)).setAttribute("src",this.src),e.setStyles({display:"inline"})},t.src=e.url)}},_getAddNewImage:function(o,a,n,l,r,e,c){return function(){var t,e,s,i;c._numberOfImages=c._numberOfImages+1,e='<div class="row"><div class="col-md-6">{{#if showFilepicker}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><div class="input-group input-append w-100"><input class="form-control {{CSS.INPUTURL}} {{CSS.INPUTURL}}-'+(t=c._numberOfImages
)+'" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/><span class="input-group-append"><button class="btn btn-secondary {{CSS.IMAGEBROWSER}} {{CSS.IMAGEBROWSER}}-'+t+'" type="button">{{get_string "browserepositories" component}}</button></span></div></div>{{else}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><input class="form-control fullwidth {{CSS.INPUTURL}} {{CSS.INPUTURL}}-'+t+'" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div>{{/if}}</div><div class="col-md-6"><div class="mdl-align"><div class="{{CSS.IMAGEPREVIEWBOX}}"><img src="#" class="{{CSS.IMAGEPREVIEW}} {{CSS.IMAGEPREVIEW}}-'+t+'" alt="" style="display: none;"/></div></div></div></div>',s=u.Handlebars.compile(e),i=u.Node.create(s({elementid:a,CSS:n,component:l,showFilepicker:r})),o.insert(i,u.one("."+n.ADDIMAGE)),this._applyImageProperties(o,t),o.one("."+n.INPUTURL+"-"+t).on("blur",this._getUrlChanged(o,t),this),r&&o.delegate("click",function(e){e.preventDefault(),this.get("host").showFilepicker("image",this._getFilepickerCallback(o,t),this)},".atto_carousel_openimagebrowser-"+t,this)}},_getUrlChanged:function(s,i){return function(){var e,t=this._attoform.one("."+d.INPUTURL+"-"+i);""!==t.get("value")&&((e=new Image).onerror=function(){s.one("."+d.IMAGEPREVIEW+"-"+i).setStyles({display:"none"})},e.onload=function(){var e;(e=s.one("."+d.IMAGEPREVIEW+"-"+i)).setAttribute("src",this.src),e.setStyles({display:"inline"})},e.src=params.url)}},_applyImageProperties:function(e,t){var s=this._getSelectedImageProperties(),i=e.one("."+d.IMAGEPREVIEW+"-"+t);!1!==s?s.src&&(e.one("."+d.INPUTURL+"-"+t).set("value",s.src),this._loadPreviewImage(s.src,t)):i.setStyle("display","none")},_getSelectedImageProperties:function(){var e,t={src:null,alt:null,presentation:!1},s=this.get("host").getSelectedNodes();return(s=s&&s.filter("img"))&&s.size()?(e=s.item(0),(this._selectedImage=e).getAttribute("style"),t.src=e.getAttribute("src"),t.presentation="presentation"===e.get("role"),t):(this._selectedImage=null,!1)},_getAlignmentPropeties:function(e,t){return!0},_urlChanged:function(){var e=this._attoform.one("."+d.INPUTURL+"-1");""!==e.get("value")&&this._loadPreviewImage(e.get("value"),1)},_setCarousel:function(e){var t,s,i,o,a,n,l,r="",c=this.get("host");if(e.preventDefault(),!this._updateWarning()){for(t=this._attoform.one("."+d.CAROUSELID).get("value"),s=u.Handlebars.compile('<div class="column-carousel-right"><div id="{{carouselid}}" class="carousel slide" data-ride="carousel"><div class="carousel-inner" role="listbox">'),carouselpre=s({carouselid:t}),r+=carouselpre,i=1;i<=this._numberOfImages;i++)o=this._attoform.one("."+d.INPUTURL+"-"+i).get("value"),console.log("url",o),""!==o&&(a="",1==i&&(a="active"),n=u.Handlebars.compile('<div class="carousel-item {{extraclasses}}"><img class="{{slidenumber}}" src="{{url}}" alt="Carousel slide" style="width:100%"><div class="container"><div class="carousel-caption d-none d-md-block text-left"></div></div></div>'),image=n({slidenumber:"first-slide",url:o,extraclasses:a}),r+=image);l=u.Handlebars.compile('</div><a class="carousel-control-prev invert" href="#{{carouselid}}" role="button" data-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next invert" href="#{{carouselid}}" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div><p><br></p>'),carouselpost=l({carouselid:t}),r+=carouselpost,c.focus(),this.get("host").insertContentAtFocusPoint(r),this.markUpdated(),this.getDialogue({focusAfterHide:null}).hide()}},_updateWarning:function(){return!1}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});